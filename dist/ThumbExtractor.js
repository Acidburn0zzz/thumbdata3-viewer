var __awaiter=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))(function(i,a){function n(e){try{o(r.next(e))}catch(e){a(e)}}function h(e){try{o(r.throw(e))}catch(e){a(e)}}function o(e){e.done?i(e.value):new s(function(t){t(e.value)}).then(n,h)}o((r=r.apply(e,t||[])).next())})};(e=>{const t=5242880;class s{constructor(){this.fileReader=new FileReader,this.fileReader.addEventListener("loadend",()=>{this.complete&&this.complete(this.fileReader.result)})}readAsArrayBuffer(e){return new Promise(t=>{this.complete=t,this.fileReader.readAsArrayBuffer(e)})}}let r;e.addEventListener("message",i=>{i.data.init&&(r&&r.cancel(),(r=new class{constructor(e){this.file=e,this.fileReader=new FileReader,this.imagePoints=[],this.markerStart=!1,this.jpegStart=0,this.readStartPos=0,this.scanStart=!1,this.scanHeader=[],this.cancelProcess=!1,this.fileReader.addEventListener("loadend",()=>{let e=this.markerStart,t=this.jpegStart,s=this.scanStart;const r=new Uint8Array(this.fileReader.result);for(let i=0;i<r.length;i++){const a=r[i];e?(216===a?(t=i-1+this.readStartPos,s=!1,this.scanHeader=[]):192===a||194===a?(s=!0,this.scanHeader=[]):196===a||219===a?s=!1:217===a?!s&&this.verifyHeader(this.scanHeader)?this.imagePoints.push([t,this.readStartPos+i+1]):(s=!1,this.scanHeader=[]):s&&this.scanHeader.push(255,a),e=!1):255===a?e=!0:s&&this.scanHeader.push(a)}this.scanStart=s,this.markerStart=e,this.jpegStart=t,this.readStartPos=this.nextPosition,this.readNextChunk()})}verifyHeader(e){if(e.length<5)return!1;const t=256*e[0]+e[1];return e.length===t||void 0}readNextChunk(){if(this.readStartPos>this.file.size||this.cancelProcess)this.done(this.imagePoints);else{const e=this.readStartPos+t,s=e>this.file.size?void 0:e,r=this.file.slice(this.readStartPos,s);this.nextPosition=e,this.fileReader.readAsArrayBuffer(r),this.progress(this.readStartPos,this.file.size)}}extractPoints(){return new Promise(e=>{this.done=e,this.readNextChunk()})}extractImages(e){return __awaiter(this,void 0,void 0,function*(){let t=new s,r=[];for(let s=0;s<e.length;s++){const[i,a]=e[s],n=this.file.slice(i,a),h=new Uint8Array(yield t.readAsArrayBuffer(n));if(r.push(URL.createObjectURL(new Blob([h],{type:"image/jpeg"}))),this.progress(s,e.length),this.cancelProcess)break}return r})}cancel(){this.cancelProcess=!0}}(i.data.init)).progress=((t,s)=>{const r=t/s*100,i=(t/1024).toFixed(0)+" kB / "+(s/1024).toFixed(0)+" kB";e.postMessage({progress:r,text:i})}),r.extractPoints().then(t=>(e.postMessage({status:"Extracting.."}),r.progress=((t,s)=>{const r=t/s*100,i=t+" / "+s;e.postMessage({progress:r,text:i})}),r.extractImages(t))).then(t=>{e.postMessage({images:t}),r=null}),e.postMessage({status:"Parsing"}))})})(self);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRodW1iRXh0cmFjdG9yLnRzIl0sIm5hbWVzIjpbInNlbGYiLCJSRUFEX0JVRkZFUiIsIlByb21pc2VSZWFkZXIiLCJbb2JqZWN0IE9iamVjdF0iLCJ0aGlzIiwiZmlsZVJlYWRlciIsIkZpbGVSZWFkZXIiLCJhZGRFdmVudExpc3RlbmVyIiwiY29tcGxldGUiLCJyZXN1bHQiLCJibG9iIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWFkQXNBcnJheUJ1ZmZlciIsImV4dHJhY3RvciIsIm1zZyIsImRhdGEiLCJpbml0IiwiY2FuY2VsIiwiZmlsZSIsImltYWdlUG9pbnRzIiwibWFya2VyU3RhcnQiLCJqcGVnU3RhcnQiLCJyZWFkU3RhcnRQb3MiLCJzY2FuU3RhcnQiLCJzY2FuSGVhZGVyIiwiY2FuY2VsUHJvY2VzcyIsIlVpbnQ4QXJyYXkiLCJpIiwibGVuZ3RoIiwiYnl0ZSIsInZlcmlmeUhlYWRlciIsInB1c2giLCJuZXh0UG9zaXRpb24iLCJyZWFkTmV4dENodW5rIiwiaGVhZGVyIiwiaGVhZGVyTGVuZ3RoIiwic2l6ZSIsImRvbmUiLCJyZWFkVG8iLCJ1bmRlZmluZWQiLCJuZXh0U2xpY2UiLCJzbGljZSIsInByb2dyZXNzIiwicG9pbnRzIiwiaW1hZ2VzIiwicmVhZFN0YXJ0IiwicmVhZEVuZCIsImZpbGVTbGljZSIsImJ1ZmZlciIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsIkJsb2IiLCJ0eXBlIiwicG9zaXRpb24iLCJ0b3RhbCIsInRleHQiLCJ0b0ZpeGVkIiwicG9zdE1lc3NhZ2UiLCJleHRyYWN0UG9pbnRzIiwidGhlbiIsInN0YXR1cyIsImV4dHJhY3RJbWFnZXMiXSwibWFwcGluZ3MiOiJ1U0FzQkEsQ0FBRUEsSUFDRSxNQUFNQyxFQUFjLGNBRXBCQyxFQVFJQyxjQUNJQyxLQUFLQyxXQUFhLElBQUlDLFdBQ3RCRixLQUFLQyxXQUFXRSxpQkFBaUIsVUFBVyxLQUNwQ0gsS0FBS0ksVUFDTEosS0FBS0ksU0FBU0osS0FBS0MsV0FBV0ksVUFJ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QixJQUFJQyxnQkFBZ0IsSUFBSUMsTUFBTUgsSUFBV0ksS0FBTSxpQkFFM0RqRCxLQUFLdUMsU0FBU2YsRUFBR2dCLEVBQU9mLFFBRXBCekIsS0FBS3NCLGNBQ0wsTUFHUixPQUFPbUIsSUFHWDFDLFNBQ0lDLEtBQUtzQixlQUFnQixJQVlPWCxFQUFJQyxLQUFLQyxPQUUzQjBCLFNBQVcsRUFBQ1csRUFBa0JDLEtBQ3BDLE1BQU1aLEVBQVlXLEVBQVdDLEVBQVMsSUFDaENDLEdBQVFGLEVBQVcsTUFBTUcsUUFBUSxHQUFLLFVBQVlGLEVBQVEsTUFBTUUsUUFBUSxHQUFLLE1BQ25GekQsRUFBSzBELGFBQWNmLFNBQVVBLEVBQVVhLEtBQU1BLE1BR2pEMUMsRUFBVTZDLGdCQUNMQyxLQUFLeEMsSUFDRnBCLEVBQUswRCxhQUFjRyxPQUFRLGlCQUMzQi9DLEVBQVU2QixTQUFXLEVBQUNXLEVBQWtCQyxLQUNwQyxNQUFNWixFQUFZVyxFQUFXQyxFQUFTLElBQ2hDQyxFQUFPRixFQUFXLE1BQVFDLEVBQ2hDdkQsRUFBSzBELGFBQWNmLFNBQVVBLEVBQVVhLEtBQU1BLE1BRTFDMUMsRUFBVWdELGNBQWMxQyxLQUVsQ3dDLEtBQUtmLElBQ0Y3QyxFQUFLMEQsYUFBY2IsT0FBUUEsSUFDM0IvQixFQUFZLE9BR3BCZCxFQUFLMEQsYUFDREcsT0FBUSxnQkFsTXhCLENBc01HN0QiLCJmaWxlIjoiVGh1bWJFeHRyYWN0b3IuanMiLCJzb3VyY2VSb290IjoiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3gwYS90aHVtYmRhdGEzLXZpZXdlci9tYXN0ZXIvc3JjLyJ9
