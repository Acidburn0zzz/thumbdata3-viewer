var __awaiter=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))(function(i,a){function n(e){try{o(r.next(e))}catch(e){a(e)}}function h(e){try{o(r.throw(e))}catch(e){a(e)}}function o(e){e.done?i(e.value):new s(function(t){t(e.value)}).then(n,h)}o((r=r.apply(e,t||[])).next())})};(e=>{const t=5e6;class s{constructor(){this.fileReader=new FileReader,this.fileReader.addEventListener("loadend",()=>{this.complete&&this.complete(this.fileReader.result)})}readAsArrayBuffer(e){return new Promise(t=>{this.complete=t,this.fileReader.readAsArrayBuffer(e)})}}let r;e.addEventListener("message",i=>{i.data.init&&(r&&r.cancel(),(r=new class{constructor(e){this.file=e,this.fileReader=new FileReader,this.imagePoints=[],this.markerStart=!1,this.jpegStart=0,this.readStartPos=0,this.cancelProcess=!1,this.fileReader.addEventListener("loadend",()=>{let e=this.markerStart,t=this.jpegStart;const s=new Uint8Array(this.fileReader.result);for(let r=0;r<s.length;r++)255!==s[r]||e?e&&(216===s[r]?t=r-1+this.readStartPos:217===s[r]&&this.imagePoints.push([t,r+this.readStartPos]),e=!1):e=!0;this.markerStart=e,this.jpegStart=t,this.readStartPos=this.nextPosition;let r=this.readNextChunk();!1===r||this.cancelProcess?this.done(this.imagePoints):this.progress(r)})}readNextChunk(){if(this.readStartPos>this.file.size)return!1;{const e=this.readStartPos+t,s=e>this.file.size?void 0:e,r=this.file.slice(this.readStartPos,s);return this.nextPosition=e,this.fileReader.readAsArrayBuffer(r),this.readStartPos/this.file.size*100}}extractPoints(){return new Promise(e=>{this.done=e,this.readNextChunk()})}extractImages(e){return __awaiter(this,void 0,void 0,function*(){let t=new s,r=[];for(let s=0;s<e.length;s++){const[i,a]=e[s],n=this.file.slice(i,a),h=new Uint8Array(yield t.readAsArrayBuffer(n));if(r.push(URL.createObjectURL(new Blob([h],{type:"image/jpeg"}))),this.progress(s/e.length*100),this.cancelProcess)break}return r})}cancel(){this.cancelProcess=!0}}(i.data.init)).progress=(t=>e.postMessage({progress:t})),r.extractPoints().then(t=>(e.postMessage({status:"Extracting.."}),r.extractImages(t))).then(t=>e.postMessage({images:t})),e.postMessage({status:"Parsing"}))})})(self);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRodW1iRXh0cmFjdG9yLnRzIl0sIm5hbWVzIjpbInNlbGYiLCJSRUFEX0JVRkZFUiIsIlByb21pc2VSZWFkZXIiLCJbb2JqZWN0IE9iamVjdF0iLCJ0aGlzIiwiZmlsZVJlYWRlciIsIkZpbGVSZWFkZXIiLCJhZGRFdmVudExpc3RlbmVyIiwiY29tcGxldGUiLCJyZXN1bHQiLCJibG9iIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWFkQXNBcnJheUJ1ZmZlciIsImV4dHJhY3RvciIsIm1zZyIsImRhdGEiLCJpbml0IiwiY2FuY2VsIiwiZmlsZSIsImltYWdlUG9pbnRzIiwibWFya2VyU3RhcnQiLCJqcGVnU3RhcnQiLCJyZWFkU3RhcnRQb3MiLCJjYW5jZWxQcm9jZXNzIiwiVWludDhBcnJheSIsImkiLCJsZW5ndGgiLCJwdXNoIiwibmV4dFBvc2l0aW9uIiwiY2h1bmtQcm9nIiwicmVhZE5leHRDaHVuayIsImRvbmUiLCJwcm9ncmVzcyIsInNpemUiLCJyZWFkVG8iLCJ1bmRlZmluZWQiLCJuZXh0U2xpY2UiLCJzbGljZSIsInBvaW50cyIsImltYWdlcyIsInJlYWRTdGFydCIsInJlYWRFbmQiLCJmaWxlU2xpY2UiLCJidWZmZXIiLCJVUkwiLCJjcmVhdGVPYmplY3RVUkwiLCJCbG9iIiwidHlwZSIsInBvc3RNZXNzYWdlIiwiZXh0cmFjdFBvaW50cyIsInRoZW4iLCJzdGF0dXMiLCJleHRyYWN0SW1hZ2VzIl0sIm1hcHBpbmdzIjoidVNBc0JBLENBQUVBLElBQ0UsTUFBTUMsRUFBYyxVQUVwQkMsRUFRSUMsY0FDSUMsS0FBS0MsV0FBYSxJQUFJQyxXQUN0QkYsS0FBS0MsV0FBV0UsaUJBQWlCLFVBQVcsS0FDcENILEtBQUtJLFVBQ0xKLEtBQUtJLFNBQVNKLEtBQUtDLFdBQVdJLFVBSTFDTixrQkFBa0JPLEdBQ2QsT0FBTyxJQUFJQyxRQUFRQyxJQUNmUixLQUFLSSxTQUFXSSxFQUNoQlIsS0FBS0MsV0FBV1Esa0JBQWtCSCxNQXVHOUMsSUFBSUksRUFFSmQsRUFBS08saUJBQWlCLFVBQVlRLElBQzFCQSxFQUFJQyxLQUFLQyxPQUNOSCxHQUNDQSxFQUFVSSxVQUdkSixFQUFZLFVBOUZoQlgsWUFBWWdCLEdBQ1JmLEtBQUtlLEtBQU9BLEVBQ1pmLEtBQUtDLFdBQWEsSUFBSUMsV0FDdEJGLEtBQUtnQixlQUNMaEIsS0FBS2lCLGFBQWMsRUFDbkJqQixLQUFLa0IsVUFBWSxFQUNqQmxCLEtBQUttQixhQUFlLEVBQ3BCbkIsS0FBS29CLGVBQWdCLEVBRXJCcEIsS0FBS0MsV0FBV0UsaUJBQWlCLFVBQVcsS0FDeEMsSUFBSWMsRUFBY2pCLEtBQUtpQixZQUNuQkMsRUFBWWxCLEtBQUtrQixVQUNyQixNQUFNTixFQUFtQixJQUFJUyxXQUF3QnJCLEtBQUtDLFdBQVdJLFFBRXJFLElBQUssSUFBSWlCLEVBQUksRUFBR0EsRUFBSVYsRUFBS1csT0FBUUQsSUFDYixNQUFaVixFQUFLVSxJQUFnQkwsRUFFZEEsSUFDUyxNQUFaTCxFQUFLVSxHQUNMSixFQUFZSSxFQUFJLEVBQUl0QixLQUFLbUIsYUFDUixNQUFaUCxFQUFLVSxJQUNWdEIsS0FBS2dCLFlBQVlRLE1BQU1OLEVBQVdJLEVBQUl0QixLQUFLbUIsZUFFL0NGLEdBQWMsR0FQZEEsR0FBYyxFQVd0QmpCLEtBQUtpQixZQUFjQSxFQUNuQmpCLEtBQUtrQixVQUFZQSxFQUNqQmxCLEtBQUttQixhQUFlbkIsS0FBS3lCLGFBRXpCLElBQUlDLEVBQVkxQixLQUFLMkIsaUJBRUgsSUFBZEQsR0FBdUIxQixLQUFLb0IsY0FDNUJwQixLQUFLNEIsS0FBSzVCLEtBQUtnQixhQUVmaEIsS0FBSzZCLFNBQVNILEtBSzFCM0IsZ0JBQ0ksR0FBSUMsS0FBS21CLGFBQWVuQixLQUFLZSxLQUFLZSxLQUM5QixPQUFPLEVBQ0osQ0FDSCxNQUFNTCxFQUFlekIsS0FBS21CLGFBQWV0QixFQUNuQ2tDLEVBQVNOLEVBQWV6QixLQUFLZSxLQUFLZSxVQUFPRSxFQUFZUCxFQUNyRFEsRUFBWWpDLEtBQUtlLEtBQUttQixNQUFNbEMsS0FBS21CLGFBQWNZLEdBS3JELE9BSEEvQixLQUFLeUIsYUFBZUEsRUFDcEJ6QixLQUFLQyxXQUFXUSxrQkFBa0J3QixHQUUxQmpDLEtBQUttQixhQUFlbkIsS0FBS2UsS0FBS2UsS0FBUSxLQUl0RC9CLGdCQUNJLE9BQU8sSUFBSVEsUUFBUUMsSUFDZlIsS0FBSzRCLEtBQU9wQixFQUNaUixLQUFLMkIsa0JBSVA1QixjQUFjb0MsbURBQ2hCLElBQUl6QixFQUFZLElBQUlaLEVBQ2hCc0MsS0FFSixJQUFLLElBQUlkLEVBQUksRUFBR0EsRUFBSWEsRUFBT1osT0FBUUQsSUFBSyxDQUNwQyxNQUFPZSxFQUFXQyxHQUFXSCxFQUFPYixHQUM5QmlCLEVBQVl2QyxLQUFLZSxLQUFLbUIsTUFBTUcsRUFBV0MsR0FDdkNFLEVBQVMsSUFBSW5CLGlCQUFpQlgsRUFBVUQsa0JBQWtCOEIsSUFLaEUsR0FIQUgsRUFBT1osS0FBS2lCLElBQUlDLGdCQUFnQixJQUFJQyxNQUFNSCxJQUFXSSxLQUFNLGlCQUUzRDVDLEtBQUs2QixTQUFVUCxFQUFJYSxFQUFPWixPQUFVLEtBQ2pDdkIsS0FBS29CLGNBQ0osTUFHUixPQUFPZ0IsSUFFWHJDLFNBQ0lDLEtBQUtvQixlQUFnQixJQVlPVCxFQUFJQyxLQUFLQyxPQUMzQmdCLFNBQVcsQ0FBQ0EsR0FBcUJqQyxFQUFLaUQsYUFBY2hCLFNBQVVBLEtBRXhFbkIsRUFBVW9DLGdCQUNMQyxLQUFLL0IsSUFDRnBCLEVBQUtpRCxhQUFjRyxPQUFRLGlCQUNwQnRDLEVBQVV1QyxjQUFjakMsS0FFbEMrQixLQUFLWCxHQUFVeEMsRUFBS2lELGFBQWNULE9BQVFBLEtBRS9DeEMsRUFBS2lELGFBQ0RHLE9BQVEsZ0JBaEp4QixDQW9KR3BEIiwiZmlsZSI6IlRodW1iRXh0cmFjdG9yLmpzIiwic291cmNlUm9vdCI6Imh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS94MGEvdGh1bWJkYXRhMy12aWV3ZXIvbWFzdGVyL3NyYy8ifQ==
